(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{AuthProvider:()=>l,useAuth:()=>c});const r=require("react");var n=e.n(r);function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o.apply(this,arguments)}const s="access-token",a=n().createContext(null),c=()=>n().useContext(a),l=e=>{let{apiBase:t,...r}=e;console.log("from common",t,r);const[c,{set:l,clear:u}]=function(){let{storage:e=window.localStorage}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const[t,r]=n().useState((()=>e.getItem(s))),o=n().useCallback((t=>{r(t),e.setItem(s,t)}),[e]),a=n().useCallback((()=>{r(null),e.removeItem(s)}),[e]);return[t,{set:o,clear:a}]}(),[i,d]=n().useState(null),g=null!=c,f=n().useCallback((async e=>{let{message:r,signature:n,address:o,signedAt:s,nonce:a}=e;const c=await fetch(`${t}/auth/login`,{method:"POST",body:JSON.stringify({message:r,signature:n,address:o,signed_at:s,nonce:a}),headers:{"Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(new Error(e.statusText))));l(c.access_token)}),[t,l]),h=n().useCallback((async(e,r)=>{if(null==c)throw new Error("Missing access token");const n=new Headers(r?.headers);n.append("Authorization",`Bearer ${c}`);const o=await fetch(`${t}${e}`,{...r,headers:n});return 401===o.status&&u(),o.ok?o.json():Promise.reject(new Error(o.statusText))}),[t,c,u]),p=n().useMemo((()=>({isSignedIn:g,accessToken:c,user:i,authorizedFetch:h,signIn:f})),[g,c,i,h,f]);return n().useEffect((()=>{g&&h("/users/me").then((e=>{d(e)}))}),[h,g]),n().createElement(a.Provider,o({value:p},r))};var u=exports;for(var i in t)u[i]=t[i];t.__esModule&&Object.defineProperty(u,"__esModule",{value:!0})})();